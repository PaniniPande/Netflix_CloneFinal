{"ast":null,"code":"import _regeneratorRuntime from\"/Users/paridhipande/Desktop/netflix-clone/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/paridhipande/Desktop/netflix-clone/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/paridhipande/Desktop/netflix-clone/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import db from\"../firebase\";import'./PlansScreen.css';import{useSelector}from'react-redux';import{selectUser}from'../features/counter/userSlice';import{loadStripe}from\"@stripe/stripe-js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function PlansScreen(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var user=useSelector(selectUser);var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),subscriptions=_useState4[0],setSubscriptions=_useState4[1];useEffect(function(){db.collection('customers').doc(user.uid).collection('subscriptions').get().then(function(querySnapshot){querySnapshot.forEach(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(subscriptions){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setSubscriptions({role:subscriptions.data().role,current_period_end:subscriptions.data().current_period_end.seconds,current_period_start:subscriptions.data().current_period_start.seconds});case 1:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());});},[user.uid]);useEffect(function(){db.collection('products').where('active','==',true).get().then(function(querySnapshot){var products={};querySnapshot.forEach(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(productDoc){var priceSnap;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:products[productDoc.id]=productDoc.data();_context2.next=3;return productDoc.ref.collection('prices').get();case 3:priceSnap=_context2.sent;priceSnap.docs.forEach(function(price){products[productDoc.id].prices={priceId:price.id,priceData:price.data()};});case 5:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());setProducts(products);});},[]);console.log(products);console.log(subscriptions);var loadCheckout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(priceId){var docRef;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return db.collection('customers').doc(user.uid).collection(\"checkout_sessions\").add({price:priceId,success_url:window.location.origin,cancel_url:window.location.origin});case 2:docRef=_context4.sent;docRef.onSnapshot(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(snap){var _snap$data,error,sessionId,stripe;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_snap$data=snap.data(),error=_snap$data.error,sessionId=_snap$data.sessionId;if(error){alert(\"An error occurred: \".concat(error.message));}if(!sessionId){_context3.next=7;break;}_context3.next=5;return loadStripe(\"pk_test_51N8VUfJSA252XYBeDOTH0XBWl3l6rgjxl8ZHVewz1DDA5iCRYcPdvO264F2q77NFQPbUleRNni82Lt6els0Rup1D00io29zoq7\");case 5:stripe=_context3.sent;stripe.redirectToCheckout({sessionId:sessionId});case 7:case\"end\":return _context3.stop();}},_callee3);}));return function(_x4){return _ref4.apply(this,arguments);};}());case 4:case\"end\":return _context4.stop();}},_callee4);}));return function loadCheckout(_x3){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"plansScreen\",children:[/*#__PURE__*/_jsx(\"br\",{}),subscriptions&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Renewal Date: \",new Date((subscriptions===null||subscriptions===void 0?void 0:subscriptions.current_period_end)*1000).toLocaleDateString()]}),Object.entries(products).map(function(_ref5){var _productData$name;var _ref6=_slicedToArray(_ref5,2),productId=_ref6[0],productData=_ref6[1];// add some logic to check if user subscriptions is active\nvar isCurrentPackage=(_productData$name=productData.name)===null||_productData$name===void 0?void 0:_productData$name.toLowerCase().includes(subscriptions===null||subscriptions===void 0?void 0:subscriptions.role);return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(isCurrentPackage&&\"plansScreen__plan--disabled\",\" plansScreen__plan\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"plansScreen__info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:productData.name}),/*#__PURE__*/_jsx(\"h6\",{children:productData.description})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return!isCurrentPackage&&loadCheckout(productData.prices.priceId);},children:isCurrentPackage?'Current Package':'Subscribe'})]},productId);})]});}export default PlansScreen;","map":{"version":3,"names":["React","useEffect","useState","db","useSelector","selectUser","loadStripe","jsx","_jsx","jsxs","_jsxs","PlansScreen","_useState","_useState2","_slicedToArray","products","setProducts","user","_useState3","_useState4","subscriptions","setSubscriptions","collection","doc","uid","get","then","querySnapshot","forEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","role","data","current_period_end","seconds","current_period_start","stop","_x","apply","arguments","where","_ref2","_callee2","productDoc","priceSnap","_callee2$","_context2","id","ref","sent","docs","price","prices","priceId","priceData","_x2","console","log","loadCheckout","_ref3","_callee4","docRef","_callee4$","_context4","add","success_url","window","location","origin","cancel_url","onSnapshot","_ref4","_callee3","snap","_snap$data","error","sessionId","stripe","_callee3$","_context3","alert","concat","message","redirectToCheckout","_x4","_x3","className","children","Date","toLocaleDateString","Object","entries","map","_ref5","_productData$name","_ref6","productId","productData","isCurrentPackage","name","toLowerCase","includes","description","onClick"],"sources":["/Users/paridhipande/Desktop/netflix-clone/src/screens/PlansScreen.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport db from \"../firebase\";\nimport './PlansScreen.css';\nimport { useSelector } from 'react-redux';\nimport { selectUser } from '../features/counter/userSlice';\nimport { loadStripe } from \"@stripe/stripe-js\";\n\nfunction PlansScreen() {\n    const [products, setProducts] = useState([]);\n    const user = useSelector(selectUser);\n    const [subscriptions, setSubscriptions] = useState(null);\n\n    useEffect(() => {\n        db.collection('customers').doc(user.uid).collection('subscriptions').get().then(querySnapshot => {\n            querySnapshot.forEach(async subscriptions => {\n                setSubscriptions({\n                    role: subscriptions.data().role,\n                    current_period_end: subscriptions.data().current_period_end.seconds,\n                    current_period_start: subscriptions.data().current_period_start.seconds\n                });\n            });\n        });\n    }, [user.uid]);\n\n    useEffect(() => {\n        db.collection('products').where('active', '==', true).get().then((querySnapshot) => {\n            const products = {};\n            querySnapshot.forEach(async productDoc => {\n                products[productDoc.id] = productDoc.data();\n                const priceSnap = await productDoc.ref.collection('prices').get();\n                priceSnap.docs.forEach(price => {\n                    products[productDoc.id].prices = {\n                        priceId: price.id,\n                        priceData: price.data()\n                    };\n                });\n            });\n            setProducts(products);\n        });\n    }, []);\n\n    console.log(products);\n    console.log(subscriptions);\n\n    const loadCheckout = async (priceId) => {\n        const docRef = await db.collection('customers').doc(user.uid).collection(\"checkout_sessions\").add({\n            price: priceId,\n            success_url: window.location.origin,\n            cancel_url: window.location.origin\n        });\n\n        docRef.onSnapshot(async (snap) => {\n            const { error, sessionId } = snap.data();\n\n            if (error) {\n                alert(`An error occurred: ${error.message}`);\n            }\n\n            if (sessionId) {\n                const stripe = await loadStripe(\"pk_test_51N8VUfJSA252XYBeDOTH0XBWl3l6rgjxl8ZHVewz1DDA5iCRYcPdvO264F2q77NFQPbUleRNni82Lt6els0Rup1D00io29zoq7\");\n                stripe.redirectToCheckout({ sessionId });\n            }\n        });\n    };\n\n    return (\n        <div className='plansScreen'>\n        <br />\n            {subscriptions && (\n                <p>\n                    Renewal Date: {new Date(subscriptions?.current_period_end * 1000).toLocaleDateString()}\n                </p>\n            )}\n            {Object.entries(products).map(([productId, productData]) => {\n                // add some logic to check if user subscriptions is active\n                const isCurrentPackage = productData.name?.toLowerCase().includes(subscriptions?.role);\n                return (\n                    <div\n                        key={productId}\n                        className={`${isCurrentPackage && \"plansScreen__plan--disabled\"} plansScreen__plan`}\n                    >\n                        <div className='plansScreen__info'>\n                            <h5>{productData.name}</h5>\n                            <h6>{productData.description}</h6>\n                        </div>\n                        <button onClick={() => !isCurrentPackage && loadCheckout(productData.prices.priceId)}>\n                            {isCurrentPackage ? 'Current Package' : 'Subscribe'}\n                        </button>\n                    </div>\n                );\n            })}\n        </div>\n    );\n}\nexport default PlansScreen;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}